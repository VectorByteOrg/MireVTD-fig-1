[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Reproducing Fig. 1 — MireVTD paper",
    "section": "",
    "text": "This page downloads VectorByte dataset 578, wrangles development-rate data, fits Bayesian thermal performance curve (TPC) models using bayesTPC/nimble, and reproduces the multi-panel figure used as Fig. 1.\nImportant: The MCMC is computationally heavy. For public repos / GitHub Pages, the recommended workflow is:\n\nRun locally once with run_mcmc &lt;- TRUE (creates results/drate_output_models.rds)\nCommit the results/ outputs\nKeep run_mcmc &lt;- FALSE for fast website renders"
  },
  {
    "objectID": "index.html#overview",
    "href": "index.html#overview",
    "title": "Reproducing Fig. 1 — MireVTD paper",
    "section": "",
    "text": "This page downloads VectorByte dataset 578, wrangles development-rate data, fits Bayesian thermal performance curve (TPC) models using bayesTPC/nimble, and reproduces the multi-panel figure used as Fig. 1.\nImportant: The MCMC is computationally heavy. For public repos / GitHub Pages, the recommended workflow is:\n\nRun locally once with run_mcmc &lt;- TRUE (creates results/drate_output_models.rds)\nCommit the results/ outputs\nKeep run_mcmc &lt;- FALSE for fast website renders"
  },
  {
    "objectID": "index.html#load-libraries",
    "href": "index.html#load-libraries",
    "title": "Reproducing Fig. 1 — MireVTD paper",
    "section": "1. Load libraries",
    "text": "1. Load libraries\n\n\nShow code\nlibrary(httr)\nlibrary(jsonlite)\nlibrary(tidyverse)\nlibrary(nimble)\nlibrary(bayesTPC)\nlibrary(coda)\nlibrary(HDInterval)\nlibrary(parallel)\nlibrary(doParallel)\nlibrary(patchwork)\nlibrary(cowplot)\nlibrary(EnvStats)"
  },
  {
    "objectID": "index.html#controls-for-public-rendering",
    "href": "index.html#controls-for-public-rendering",
    "title": "Reproducing Fig. 1 — MireVTD paper",
    "section": "2. Controls for public rendering",
    "text": "2. Controls for public rendering\n\n\nShow code\n# Set TRUE only when running locally to generate the cached model outputs\nrun_mcmc &lt;- FALSE\nrds_file &lt;- \"results/drate_output_models.rds\"\n\ndir.create(\"results\", showWarnings = FALSE)"
  },
  {
    "objectID": "index.html#minimal-vectorbyte-dataset-retrieval-function",
    "href": "index.html#minimal-vectorbyte-dataset-retrieval-function",
    "title": "Reproducing Fig. 1 — MireVTD paper",
    "section": "3. Minimal VectorByte dataset retrieval function",
    "text": "3. Minimal VectorByte dataset retrieval function\nThis replaces the full interactive API client. It downloads the dataset cleanly and returns a dataframe.\n\n\nShow code\nget_vectorbyte_dataset &lt;- function(id, useQA = FALSE) {\n  base &lt;- paste0(\"https://vectorbyte\", ifelse(useQA, \"-qa\", \"\"), \".crc.nd.edu\")\n  url  &lt;- paste0(base, \"/portal/api/vectraits-dataset/\", id, \"/?format=json\")\n  raw  &lt;- GET(url)\n  stop_for_status(raw)\n  fromJSON(content(raw, \"text\"), flatten = TRUE)[[1]]\n}"
  },
  {
    "objectID": "index.html#download-and-inspect-dataset",
    "href": "index.html#download-and-inspect-dataset",
    "title": "Reproducing Fig. 1 — MireVTD paper",
    "section": "4. Download and inspect dataset",
    "text": "4. Download and inspect dataset\n\n\nShow code\ndf &lt;- get_vectorbyte_dataset(578)\n\n# Optional check of structure\ndf %&gt;% distinct(OriginalTraitName, Interactor1Temp, SecondStressorValue)\n\n\n   OriginalTraitName Interactor1Temp SecondStressorValue\n1   development time              22                  55\n2   development time              32                  55\n3   development time              22                 110\n4   development time              26                 110\n5   development time              32                 110\n6   development time              34                 110\n7   development time              22                 165\n8   development time              26                 165\n9   development time              32                 165\n10  development time              34                 165\n11  development time              22                 220\n12  development time              26                 220\n13  development time              32                 220\n14  development time              34                 220\n15  development time              26                  55\n16  development time              34                  55"
  },
  {
    "objectID": "index.html#data-wrangling-for-development-rate-analysis",
    "href": "index.html#data-wrangling-for-development-rate-analysis",
    "title": "Reproducing Fig. 1 — MireVTD paper",
    "section": "5. Data wrangling for development rate analysis",
    "text": "5. Data wrangling for development rate analysis\n\n\nShow code\n# Mean curve\ndevelopment_rate_mean &lt;- df %&gt;% \n  filter(SecondStressorValue == 165) %&gt;%\n  group_by(Interactor1Temp) %&gt;%\n  summarise(Trait = mean(1 / OriginalTraitValue), .groups = \"drop\") %&gt;%\n  mutate(curve_ID = factor(1), Temp = Interactor1Temp)\n\n# Individual observations\ndevelopment_rate_individuals &lt;- df %&gt;%\n  filter(SecondStressorValue == 165) %&gt;%\n  mutate(curve_ID = factor(2),\n         Temp = Interactor1Temp,\n         Trait = 1 / OriginalTraitValue)\n\n# Combined dataset\ndrate_dat &lt;- bind_rows(development_rate_mean, development_rate_individuals)"
  },
  {
    "objectID": "index.html#plot-raw-data",
    "href": "index.html#plot-raw-data",
    "title": "Reproducing Fig. 1 — MireVTD paper",
    "section": "6. Plot raw data",
    "text": "6. Plot raw data\n\n\nShow code\np_raw &lt;- ggplot() +\n  geom_jitter(data = development_rate_individuals,\n              aes(Temp, Trait),\n              size = 2, shape = 21, fill = \"black\", col = \"white\",\n              width = 0.12) +\n  geom_point(data = development_rate_mean,\n             aes(Temp, Trait),\n             size = 3, shape = 22, colour = \"black\", fill = \"red\") +\n  theme_bw()\n\np_raw"
  },
  {
    "objectID": "index.html#hyperparameters-for-bayesian-tpc-fitting",
    "href": "index.html#hyperparameters-for-bayesian-tpc-fitting",
    "title": "Reproducing Fig. 1 — MireVTD paper",
    "section": "7. Hyperparameters for Bayesian TPC fitting",
    "text": "7. Hyperparameters for Bayesian TPC fitting\n\nThermal performance curve model choice\nThe exponential model used to describe temperature-dependent development time (Equation 2 in the main text) is not unimodal and does not have defined values for \\(T_\\mathrm{min}\\), \\(T_\\mathrm{pk}\\), \\(B_\\mathrm{pk}\\), or \\(T_\\mathrm{max}\\). To facilitate direct comparison with previous studies, we therefore fitted the standard Brière thermal performance curve model to inverted development times (i.e. development rate, \\(1/\\alpha\\)).\nThe Brière model was fitted as implemented in the bayesTPC package in R (Brière et al. 1999; Sorek et al. 2025).\n\\[\n\\label{eq:BriereModel}\n\\frac{1}{\\alpha(T)} =\nq \\cdot T \\cdot (T - T_\\mathrm{min}) \\cdot\n\\sqrt{(T_\\mathrm{max} - T)} \\cdot\n\\mathbb{I}(T &gt; T_\\mathrm{min}) \\cdot \\mathbb{I}(T &lt; T_\\mathrm{max})\n\\]\nHere, \\(T\\) is temperature (°C), \\(T_\\mathrm{min}\\) is the lower thermal limit at which rates become zero, \\(T_\\mathrm{max}\\) is the upper thermal limit at which rates become zero, and \\(q\\) is a scaling parameter that determines the maximum rate.\nPeak temperature (\\(T_\\mathrm{pk}\\)) and peak performance (\\(B_\\mathrm{pk}\\)) were not explicit parameters of the model and were therefore estimated numerically from posterior samples of each fitted thermal performance curve. These quantities were summarized using posterior medians and Highest Posterior Density (HPD) intervals.\n\n\nShow code\niterations &lt;- 50000\nburnin     &lt;- 10000\ntemps      &lt;- seq(0, 50, length = 1000)\n\n\n\n8. Prepare data and fit TPC models (averages vs individuals)\n\n\nShow code\ndata_list &lt;- split(drate_dat, drate_dat$curve_ID)\n\nif (run_mcmc) {\n\n  # Parallel backend (adjust cores according to your system)\n  cl &lt;- makeCluster(min(10, detectCores()))\n  registerDoParallel(cl)\n\n  drate_output_models &lt;- foreach(i = seq_along(data_list)) %dopar% {\n\n    dat &lt;- data_list[[i]]\n    lf.data.bTPC &lt;- list(Temp = dat$Temp, Trait = dat$Trait)\n\n    library(nimble)\n    library(bayesTPC)\n\n    b_TPC(data     = lf.data.bTPC,\n          model    = \"briere\",\n          priors   = list(T_min = \"dunif(10,20)\",\n                          T_max = \"dunif(30,40)\"),\n          inits    = list(T_min = 15, T_max = 35),\n          thin     = 5,\n          samplerType = \"AF_slice\",\n          burn     = burnin,\n          niter    = iterations)\n  }\n\n  stopCluster(cl)\n\n  saveRDS(drate_output_models, rds_file)\n\n} else {\n\n  if (!file.exists(rds_file)) {\n    stop(\n      \"Missing cached models at: \", rds_file, \"\\n\",\n      \"Run locally once with run_mcmc &lt;- TRUE to create it, then commit results/.\"\n    )\n  }\n\n  drate_output_models &lt;- readRDS(rds_file)\n}"
  },
  {
    "objectID": "index.html#posterior-summaries-predictions-and-hpds",
    "href": "index.html#posterior-summaries-predictions-and-hpds",
    "title": "Reproducing Fig. 1 — MireVTD paper",
    "section": "9. Posterior summaries, predictions, and HPDs",
    "text": "9. Posterior summaries, predictions, and HPDs\n\n\nShow code\npars      &lt;- list()\nfits      &lt;- list()\ndrateHPD  &lt;- list()\n\nfor (i in seq_along(drate_output_models)) {\n\n  m  &lt;- drate_output_models[[i]]\n  samples &lt;- m$samples\n  hpds    &lt;- HPDinterval(samples)\n\n  # Prediction grid\n  mybriere &lt;- get_model_function(\"briere\")\n  l &lt;- nrow(samples)\n\n  pred_mat &lt;- matrix(NA, nrow = l, ncol = length(temps))\n\n  for (k in 1:l) {\n    pred_mat[k, ] &lt;- mybriere(temps,\n                              T_max = samples[k, 1],\n                              T_min = samples[k, 2],\n                              q     = samples[k, 3])\n  }\n\n  # HPD intervals across temperatures\n  HPDtemp &lt;- sapply(seq_along(temps), function(j) {\n    interval &lt;- HPDinterval(mcmc(pred_mat[, j]))\n    c(lower = interval[1], upper = interval[2])\n  })\n\n  drateHPD[[i]] &lt;- as.data.frame(t(HPDtemp)) |&gt;\n    mutate(Temp = temps,\n           curve_ID = factor(i),\n           Trait_lwr = lower,\n           Trait_upr = upper) |&gt;\n    select(Temp, Trait_lwr, Trait_upr, curve_ID)\n\n  # Fit summaries\n  fit_sum &lt;- predict(m, temp_interval = temps)\n  fit_sum$temp_interval &lt;- NULL\n\n  fits[[i]] &lt;- bind_cols(Temp = temps, fit_sum,\n                         curve_ID = factor(i),\n                         species  = \"Aedes aegypti\")\n\n  # Peak estimates\n  Tmax_vals &lt;- samples[,1]\n  Tmin_vals &lt;- samples[,2]\n\n  Tpk_samples &lt;- temps[apply(pred_mat, 1, which.max)]\n  Bpk_samples &lt;- apply(pred_mat, 1, max)\n\n  pars[[i]] &lt;- tibble(\n    curve_ID = factor(i),\n    Tmin_mean = mean(Tmin_vals),\n    Tmin_lwr  = hpds[2,1],\n    Tmin_upr  = hpds[2,2],\n    Tmax_mean = mean(Tmax_vals),\n    Tmax_lwr  = hpds[1,1],\n    Tmax_upr  = hpds[1,2],\n    Tpk_median = median(Tpk_samples),\n    Tpk_lwr    = HPDinterval(as.mcmc(Tpk_samples))[1],\n    Tpk_upr    = HPDinterval(as.mcmc(Tpk_samples))[2],\n    Bpk_median = median(Bpk_samples),\n    Bpk_lwr    = HPDinterval(as.mcmc(Bpk_samples))[1],\n    Bpk_upr    = HPDinterval(as.mcmc(Bpk_samples))[2]\n  )\n}\n\ndrateHPD_combined &lt;- bind_rows(drateHPD)\nfits_combined     &lt;- bind_rows(fits)\npars_combined     &lt;- bind_rows(pars)"
  },
  {
    "objectID": "index.html#plotting-tpc-fits-data",
    "href": "index.html#plotting-tpc-fits-data",
    "title": "Reproducing Fig. 1 — MireVTD paper",
    "section": "10. Plotting: TPC Fits + Data",
    "text": "10. Plotting: TPC Fits + Data\n\n\nShow code\nj1 &lt;-\n  ggplot() +\n  scale_y_continuous(expression(plain(paste(\"development rate,\",\" day\"^{-1}))),\n                     limits =c(-.01,.41),\n                     expand = c(0, 0),\n                     breaks=seq(0,.4, by=.1)) +\n  scale_x_continuous(expression(plain(paste(\" Temperature, \", degree, \"C\")))) +\n\n  # Plot HPD intervals using geom_ribbon\n  geom_ribbon(aes(Temp, ymin = Trait_lwr, ymax = Trait_upr, group = curve_ID, fill = curve_ID),\n              data = drateHPD_combined, alpha = 0.5, inherit.aes = FALSE) +\n\n  # Plot the fit lines\n  geom_line(aes(Temp, medians, group = curve_ID, colour = curve_ID),\n            data = fits_combined, linewidth = 0.2) +\n\n  # Plot points for curve_ID 1\n  geom_point(data = subset(drate_dat, curve_ID == 1),\n             aes(Temp, Trait, col = curve_ID, fill = curve_ID, shape = curve_ID),\n             stroke = .2, size = 3) +\n\n  # Plot points for curve_ID 2 with jitter\n  geom_jitter(data = subset(drate_dat, curve_ID == 2),\n              aes(Temp, Trait, col = curve_ID, fill = curve_ID, shape = curve_ID),\n              alpha = .3, width = .5, stroke = .2, size = 1) +\n\n  # Customize legend and other aesthetics\n  scale_shape_manual(name = expression(bold(\"\")),\n                     labels = c(\"averages\", \"individuals\"),\n                     values = c(24, 23),\n                     guide = guide_legend(nrow = 2, ncol = 1,\n                                          direction = \"horizontal\",\n                                          title.position = \"top\",\n                                          title.hjust = 0.5)) +\n\n  scale_fill_manual(name = expression(bold(\"\")),\n                    labels = c(\"averages\", \"individuals\"),\n                    values = c(\"#bdd7e7\", \"#fb8501\"),\n                    guide = guide_legend(nrow = 2, ncol = 1,\n                                         direction = \"horizontal\",\n                                         title.position = \"top\",\n                                         title.hjust = 0.5)) +\n\n  scale_colour_manual(name = expression(bold(\"\")),\n                      labels = c(\"averages\", \"individuals\"),\n                      values = c(\"#000000\", \"#fb8501\"),\n                      guide = guide_legend(nrow = 2, ncol = 1,\n                                           direction = \"horizontal\",\n                                           title.position = \"top\",\n                                           title.hjust = 0.5)) +\n\n  theme_bw(base_size = 14) +\n  theme(legend.position = c(.255, .9),\n        text = element_text(face = 'plain'),\n        legend.background = element_rect(colour = \"black\", linewidth = 0.15),\n        axis.title.y = element_text(size = 14),\n        legend.title = element_text(size = 1),\n        legend.key.spacing.y = unit(.1, \"cm\"),\n        legend.text = element_text(size = 6.5),\n        legend.box.margin = margin(0, 0, 0, 0),\n        legend.key.height = unit(.1, \"cm\"),\n        legend.spacing = unit(1, \"mm\"),\n        panel.grid.major = element_blank(),\n        panel.grid.minor = element_blank()) +\n\n  # Annotate plot\n  annotate(\"text\", x = 48, y = 0.35, label = 'a', size = 4.5)\n\nj1"
  },
  {
    "objectID": "index.html#panel-b-tpk-vs-bpk-j2",
    "href": "index.html#panel-b-tpk-vs-bpk-j2",
    "title": "Reproducing Fig. 1 — MireVTD paper",
    "section": "11. Panel b: Tpk vs Bpk (j2)",
    "text": "11. Panel b: Tpk vs Bpk (j2)\n\n\nShow code\nj2 &lt;- pars_combined %&gt;% mutate(curve_ID = factor(curve_ID)) %&gt;%\n  ggplot()+\n  geom_linerange(aes(x=Tpk_median,xmin=Tpk_lwr,xmax=Tpk_upr,y=Bpk_median,\n                     group=curve_ID, col=curve_ID),lwd=.35)+\n  geom_linerange(aes(y=Bpk_median,ymin=Bpk_lwr,ymax=Bpk_upr,x=Tpk_median,\n                     group=curve_ID, col=curve_ID), lwd=.35)+\n  geom_point(aes(Tpk_median,Bpk_median,group=curve_ID,shape=curve_ID,fill=curve_ID), col=\"black\",\n             alpha = 1, stroke=0.25, size=1.5) +\n  scale_x_continuous(name=expression(plain(paste(italic(T)[pk]))),\n                     limits =c(25.75,34.25),\n                     expand = c(0, 0),\n                     breaks=seq(26,34, by=4))+\n  scale_y_continuous(name=expression(plain(\"rate\")),\n                     limits =c(-0.01,.41),\n                     expand = c(0, 0),\n                     breaks=seq(0,.4, by=0.2))+\n  theme_bw(base_size = 14)+\n  scale_shape_manual(name=expression(bold(\"\")),\n                     labels = c(\"averages\", \"individuals\"),\n                     values = c(24,23),\n                     guide = guide_legend(nrow=2,ncol=1,\n                                          direction = \"horizontal\",\n                                          title.position = \"top\",\n                                          title.hjust=0.5))+\n  scale_fill_manual(name=expression(bold(\"\")),\n                    labels = c(\"averages\", \"individuals\"),\n                    values = c(\"#bdd7e7\",\"#fb8501\"),\n                    guide = guide_legend(nrow=2,ncol=1,\n                                         direction = \"horizontal\",\n                                         title.position = \"top\",\n                                         title.hjust=0.5))+\n  scale_colour_manual(name=expression(bold(\"\")),\n                      labels = c(\"averages\", \"individuals\"),\n                      values = c(\"#bdd7e7\",\"#fb8501\"),\n                      guide = guide_legend(nrow=2,ncol=1,\n                                           direction = \"horizontal\",\n                                           title.position = \"top\",\n                                           title.hjust=0.5))+\n  theme(legend.position = \"none\",\n        panel.grid.major = element_blank(),\n        panel.grid.minor = element_blank())+\n  annotate(\"text\", x = 33, y = 0.35, label = 'b', size = 4.5)\n\nj2"
  },
  {
    "objectID": "index.html#panel-c-tmax-vs-tmin",
    "href": "index.html#panel-c-tmax-vs-tmin",
    "title": "Reproducing Fig. 1 — MireVTD paper",
    "section": "12. Panel c: Tmax vs Tmin",
    "text": "12. Panel c: Tmax vs Tmin\n\n\nShow code\nj3 &lt;-\n  pars_combined %&gt;% mutate(curve_ID = factor(curve_ID)) %&gt;%\n  ggplot()+\n  geom_linerange(aes(y=Tmax_mean,ymin=Tmax_lwr,ymax=Tmax_upr,x=Tmin_mean,group=curve_ID, col=curve_ID),lwd=.35)+\n  geom_linerange(aes(x=Tmin_mean,xmin=Tmin_lwr,xmax=Tmin_upr,y=Tmax_mean,group=curve_ID, col=curve_ID),lwd=.35)+\n  geom_point(aes(Tmin_mean,Tmax_mean,group=curve_ID,shape=curve_ID,fill=curve_ID), col=\"black\",\n             alpha = 1, stroke=0.25, size=1.5)+\n  scale_y_continuous(name=expression(plain(paste(italic(T)[max]))),\n                     limits =c(29,41),\n                     expand = c(0, 0),\n                     breaks=seq(30,40, by=5))+\n  scale_x_continuous(name=expression(plain(paste(italic(T)[min]))),\n                     limits =c(9.9,20.1),\n                     expand = c(0, 0),\n                     breaks=seq(10,20, by=5))+\n  theme_bw(base_size = 14)+\n  scale_shape_manual(name=expression(bold(\"\")),\n                     labels = c(\"averages\", \"individuals\"),\n                     values = c(24,23),\n                     guide = guide_legend(nrow=2,ncol=1,\n                                          direction = \"horizontal\",\n                                          title.position = \"top\",\n                                          title.hjust=0.5))+\n  scale_fill_manual(name=expression(bold(\"\")),\n                    labels = c(\"averages\", \"individuals\"),\n                    values = c(\"#bdd7e7\",\"#fb8501\"),\n                    guide = guide_legend(nrow=2,ncol=1,\n                                         direction = \"horizontal\",\n                                         title.position = \"top\",\n                                         title.hjust=0.5))+\n  scale_colour_manual(name=expression(bold(\"\")),\n                      labels = c(\"averages\", \"individuals\"),\n                      values = c(\"#bdd7e7\",\"#fb8501\"),\n                      guide = guide_legend(nrow=2,ncol=1,\n                                           direction = \"horizontal\",\n                                           title.position = \"top\",\n                                           title.hjust=0.5))+\n  theme(legend.position = \"none\",\n        legend.title = element_text(size=1),\n        legend.text = element_text(size=6),\n        legend.key.height = unit(.2, \"cm\"),\n        legend.key.spacing.y = unit(.01, \"cm\"),\n        legend.key.width = unit(.3, \"cm\"),\n        legend.spacing = unit(.01, \"cm\"),\n        panel.grid.major = element_blank(),\n        panel.grid.minor = element_blank())+\n  annotate(\"text\", x = 18.5, y = 38.85, label = 'c', size = 4.5)\n\nj3"
  },
  {
    "objectID": "index.html#save-panels",
    "href": "index.html#save-panels",
    "title": "Reproducing Fig. 1 — MireVTD paper",
    "section": "12. Save panels",
    "text": "12. Save panels\n\n\nShow code\nj4 &lt;- j2 + j3 + plot_layout(ncol = 1)\nj5 &lt;- j1 + j4 + plot_layout(ncol = 2)\n\nggsave(\"results/example-of-averages-vs-individuals.pdf\", j4,\n       width = 6.5, height = 6.5, units = \"cm\")\n\nggsave(\"results/panel-example-ave-vs-inds.pdf\", j5,\n       width = 16, height = 7.75, units = \"cm\")\n\nj5"
  }
]